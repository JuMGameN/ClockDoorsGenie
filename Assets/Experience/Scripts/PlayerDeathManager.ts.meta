fileFormatVersion: 2
guid: 1c8f64d7a90e8ea4189a83b7be166600
ScriptedImporter:
  internalIDToNameTable: []
  externalObjects: {}
  serializedVersion: 2
  userData: 
  assetBundleName: 
  assetBundleVariant: 
  script: {fileID: 11500000, guid: 22604dd76f55453daccee3ed9e7b94b5, type: 3}
  SerializedAsset: '{"IsCompiled":true,"CompilerVersion":"2.0.63","ReferencedSpecifiers":["@assets/Experience/Scripts/PlayerStaminaManager","@assets/Experience/Scripts/AudioManager","@assets/Experience/Scripts/GameManager","@assets/Experience/Scripts/TimerManager"],"Source":"\"use
    strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst
    UnityEngine_1 = require(\"UnityEngine\");\nconst AudioManager_1 = require(\"@assets/Experience/Scripts/AudioManager\");\nconst
    Genies_Avatars_Sdk_1 = require(\"Genies.Avatars.Sdk\");\nconst GameManager_1
    = require(\"@assets/Experience/Scripts/GameManager\");\nconst TimerManager_1
    = require(\"@assets/Experience/Scripts/TimerManager\");\nclass PlayerDeathManager
    extends UnityEngine_1.MonoBehaviour {\n    constructor() {\n        super(...arguments);\n       
    this.respawnTime = 3;\n        this.isDead = false;\n    }\n    async Start()
    {\n        this.characterController = this.GetComponent($typeof(UnityEngine_1.CharacterController));\n       
    this.staminaManager = // @ts-ignore\n            this.GetComponent(\"@assets/Experience/Scripts/PlayerStaminaManager.PlayerStaminaManager\");\n       
    if (this.staminaManager != null) {\n            this.staminaManager.onStaminaChange.addListener(this.checkDeath,
    //@ts-ignore\n            this);\n        }\n        this.player = this.gameObject;\n       
    await this.getAnimatorFromChildren();\n        GameManager_1.default.Instance.OnLoading.addListener(()
    => this.respawn());\n    }\n    async getAnimatorFromChildren() {\n        const
    avatar = this.GetComponent($typeof(Genies_Avatars_Sdk_1.CreateUserAvatar));\n       
    // Wait until `DidSpawn` is true\n        while (!avatar.DidSpawn) {\n           
    TimerManager_1.default.Instance.stopTimer();\n            await new Promise(resolve
    => setTimeout(resolve, 100));\n        }\n        TimerManager_1.default.Instance.startTimer();\n       
    this.animator = this.GetComponentInChildren($typeof(UnityEngine_1.Animator));\n   
    }\n    checkDeath(stamina) {\n        if (stamina <= 0 && !this.isDead) {\n           
    TimerManager_1.default.Instance.stopTimer();\n            this.die(this.staminaManager.isInDeathArea);\n       
    }\n    }\n    die(isInDeathArea) {\n        this.isDead = true;\n        if (isInDeathArea)
    {\n            this.animator.SetBool(\"IsDeadFalling\", true);\n        }\n       
    else {\n            this.animator.SetBool(\"IsDead\", true);\n        }\n       
    AudioManager_1.default.Instance.playSFX(this.deathSound);\n        setTimeout(()
    => {\n            this.respawn();\n            GameManager_1.default.Instance.ChangeGameState(GameManager_1.GameState.GAME_OVER);\n       
    }, 3000);\n    }\n    respawn() {\n        this.characterController.enabled =
    false;\n        // Instantly move the player to the respawn point\n        this.transform.position
    = this.respawnPoint.position;\n        this.transform.rotation = UnityEngine_1.Quaternion.identity;\n       
    // Re-enable CharacterController after a short delay\n        setTimeout(() =>
    {\n            this.characterController.enabled = true;\n        }, 100);\n       
    // Reset stamina\n        if (this.staminaManager) {\n            this.staminaManager.resetStamina();\n       
    }\n        this.animator.SetBool(\"IsDead\", false);\n        this.animator.SetBool(\"IsDeadFalling\",
    false);\n        this.isDead = false;\n        TimerManager_1.default.Instance.resetTimer();\n   
    }\n}\nexports.default = PlayerDeathManager;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGxheWVyRGVhdGhNYW5hZ2VyLmpzIiwibWFwcGluZ3MiOiI7O0FBQ0EsNkNBQXNIO0FBRXRILDBFQUF5QztBQUN6QywyREFBcUQ7QUFDckQsd0VBQXNEO0FBQ3RELDBFQUF5QztBQUN6QyxNQUFxQixrQkFBbUIsU0FBUSwyQkFBYTtJQUE3RDs7UUFLSSxnQkFBVyxHQUFHLENBQUM7UUFJUCxXQUFNLEdBQUcsS0FBSztJQThFMUI7SUEzRUksS0FBSyxDQUFDLEtBQUs7UUFDUCxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLFlBQVcsU0FBRSxpQ0FBa0IsRUFBSTtRQUNuRSxJQUFJLENBQUMsY0FBYyxHQUFFO1lBQUMsSUFBSSxDQUFDLFlBQVcsdUVBQXFCLENBQUk7UUFFL0QsSUFBSSxJQUFJLENBQUMsY0FBYyxJQUFJLElBQUksRUFBRTtZQUM3QixJQUFJLENBQUMsY0FBYyxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVM7Z0JBQUMsQ0FBQztRQUNwRTtRQUNBLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFVBQVU7UUFDN0IsTUFBTSxJQUFJLENBQUMsdUJBQXVCLEVBQUU7UUFDcEMscUJBQVcsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDcEU7SUFFUSxLQUFLLENBQUMsdUJBQXVCO1FBQ2pDLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFXLFNBQUUscUNBQWUsRUFBSTtRQUVwRCxnQ0FBK0I7UUFDL0IsT0FBTyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUU7WUFDckIsc0JBQVksQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFO1lBQ2pDLE1BQU0sSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQzFEO1FBQ0Esc0JBQVksQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFO1FBQ2xDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLHNCQUFxQixTQUFFLHNCQUFPLEVBQUk7SUFDM0Q7SUFHUSxVQUFVLENBQUMsT0FBZTtRQUM5QixJQUFJLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQzlCLHNCQUFZLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRTtZQUNqQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDO1FBQy9DO0lBQ0o7SUFFUSxHQUFHLENBQUMsYUFBc0I7UUFDOUIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJO1FBRWxCLElBQUksYUFBYSxFQUFFO1lBQ2YsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQztRQUNoRDthQUNLO1lBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQztRQUN6QztRQUNBLHNCQUFZLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBRTlDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDWixJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2QscUJBQVcsQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLHVCQUFTLENBQUMsU0FBUyxDQUFDO1FBQzdELENBQUMsRUFBRSxJQUFJLENBQUM7SUFDWjtJQUVRLE9BQU87UUFDWCxJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxHQUFHLEtBQUs7UUFFeEMsaURBQWdEO1FBQ2hELElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUTtRQUNwRCxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyx3QkFBVSxDQUFDLFFBQVE7UUFFN0Msb0RBQW1EO1FBQ25ELFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDWixJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxHQUFHLElBQUk7UUFDM0MsQ0FBQyxFQUFFLEdBQUcsQ0FBQztRQUVQLGdCQUFlO1FBQ2YsSUFBSSxJQUFJLENBQUMsY0FBYyxFQUFFO1lBQ3JCLElBQUksQ0FBQyxjQUFjLENBQUMsWUFBWSxFQUFFO1FBQ3RDO1FBQ0EsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQztRQUN0QyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxlQUFlLEVBQUUsS0FBSyxDQUFDO1FBRzdDLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSztRQUNuQixzQkFBWSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUU7SUFDdEM7Q0FJSjtBQXZGQSxxQ0F1RkEiLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VzIjpbIlBsYXllckRlYXRoTWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6W251bGxdfQ==","ScriptHash":"b6569cefe7f140572828a1792080d833","Specifier":"@assets/Experience/Scripts/PlayerDeathManager","DefaultTypeName":"@assets/Experience/Scripts/PlayerDeathManager.PlayerDeathManager","IsMonobehaviour":true,"IsScriptableObj":false,"InheritanceChain":["@assets/Experience/Scripts/PlayerDeathManager.PlayerDeathManager","UnityEngine.MonoBehaviour","UnityEngine.Behaviour","UnityEngine.Component","UnityEngine.Object","@com.genies.scripting@1.11.0\\Runtime\\Typing\\index.d.System.Object"],"Properties":[{"Path":"respawnPoint","Name":"respawnPoint","TypeName":"UnityEngine.Transform","AssemblyName":null,"EnumKeys":[],"EnumValues":[],"IsGeniesBehaviourRef":false,"IsGeniesScriptableObjectRef":false,"Decorators":[],"Initializers":[],"ArrayDimension":-1,"IsArray":false,"IsEnum":false,"ArrayElementInitializer":null,"ChildProperties":[],"PrettyName":"Respawn
    Point","_arrayElementInitializerJson":null,"_childPropertiesJson":"[]","_prettyName":null},{"Path":"player","Name":"player","TypeName":"UnityEngine.GameObject","AssemblyName":null,"EnumKeys":[],"EnumValues":[],"IsGeniesBehaviourRef":false,"IsGeniesScriptableObjectRef":false,"Decorators":[],"Initializers":[],"ArrayDimension":-1,"IsArray":false,"IsEnum":false,"ArrayElementInitializer":null,"ChildProperties":[],"PrettyName":"Player","_arrayElementInitializerJson":null,"_childPropertiesJson":"[]","_prettyName":null},{"Path":"deathSound","Name":"deathSound","TypeName":"System.String","AssemblyName":null,"EnumKeys":[],"EnumValues":[],"IsGeniesBehaviourRef":false,"IsGeniesScriptableObjectRef":false,"Decorators":[],"Initializers":[],"ArrayDimension":-1,"IsArray":false,"IsEnum":false,"ArrayElementInitializer":null,"ChildProperties":[],"PrettyName":"Death
    Sound","_arrayElementInitializerJson":null,"_childPropertiesJson":"[]","_prettyName":null},{"Path":"respawnTime","Name":"respawnTime","TypeName":"System.Double","AssemblyName":null,"EnumKeys":[],"EnumValues":[],"IsGeniesBehaviourRef":false,"IsGeniesScriptableObjectRef":false,"Decorators":[],"Initializers":["3"],"ArrayDimension":-1,"IsArray":false,"IsEnum":false,"ArrayElementInitializer":null,"ChildProperties":[],"PrettyName":"Respawn
    Time","_arrayElementInitializerJson":null,"_childPropertiesJson":"[]","_prettyName":null},{"Path":"animator","Name":"animator","TypeName":"UnityEngine.Animator","AssemblyName":null,"EnumKeys":[],"EnumValues":[],"IsGeniesBehaviourRef":false,"IsGeniesScriptableObjectRef":false,"Decorators":[],"Initializers":[],"ArrayDimension":-1,"IsArray":false,"IsEnum":false,"ArrayElementInitializer":null,"ChildProperties":[],"PrettyName":"Animator","_arrayElementInitializerJson":null,"_childPropertiesJson":"[]","_prettyName":null}],"SupportedUiEvents":"None","DisplayName":"PlayerDeathManager","name":"PlayerDeathManager","hideFlags":"NotEditable"}'
